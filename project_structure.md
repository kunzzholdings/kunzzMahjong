# ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

## å®Œæ•´ç›®å½•æ ‘

```
mahjong-game/
â”œâ”€â”€ ğŸ“„ server.js              # Node.js åç«¯æœåŠ¡å™¨ (æ ¸å¿ƒ)
â”œâ”€â”€ ğŸ“„ package.json           # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ ğŸ“„ README.md              # å®Œæ•´è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ QUICKSTART.md          # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â”œâ”€â”€ ğŸ“„ SOCKET_EVENTS.md       # Socket äº‹ä»¶è¯¦ç»†è¯´æ˜
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md   # æœ¬æ–‡æ¡£
â”‚
â””â”€â”€ ğŸ“‚ public/                # å‰ç«¯é™æ€æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ ğŸ“„ index.html         # æ¸¸æˆä¸»ç•Œé¢ (HTML)
    â”œâ”€â”€ ğŸ“„ style.css          # æ ·å¼æ–‡ä»¶ (CSS)
    â”œâ”€â”€ ğŸ“„ client.js          # å‰ç«¯é€»è¾‘ (JavaScript)
    â”‚
    â””â”€â”€ ğŸ“‚ assets/            # èµ„æºæ–‡ä»¶ç›®å½• (å¯é€‰)
        â””â”€â”€ ğŸ“„ README.md      # èµ„æºä½¿ç”¨è¯´æ˜
```

---

## ğŸ“„ æ–‡ä»¶è¯¦ç»†è¯´æ˜

### åç«¯æ ¸å¿ƒæ–‡ä»¶

#### `server.js` (580+ è¡Œ)
**åŠŸèƒ½**ï¼šNode.js + Express + Socket.IO æœåŠ¡å™¨

**ä¸»è¦å†…å®¹**ï¼š
```javascript
// 1. ä¾èµ–å¯¼å…¥
const express = require('express');
const socketIo = require('socket.io');

// 2. éº»å°†ç‰Œå®šä¹‰
const TILES = { WAN, TIAO, TONG, HONOR }

// 3. æˆ¿é—´ç±» (Room)
class Room {
  constructor()         // åˆå§‹åŒ–æˆ¿é—´
  addPlayer()          // æ·»åŠ ç©å®¶
  startGame()          // å¼€å§‹æ¸¸æˆ
  drawTile()           // æ‘¸ç‰Œ
  discardTile()        // å‡ºç‰Œ
  canPong/Chow/Kong()  // åˆ¤æ–­å¯å¦æ“ä½œ
  performPong/Chow/Kong() // æ‰§è¡Œæ“ä½œ
  checkWin()           // åˆ¤æ–­èƒ¡ç‰Œ
  calculateFan()       // è®¡ç®—ç•ªå‹
}

// 4. Socket.IO äº‹ä»¶å¤„ç†
io.on('connection', (socket) => {
  socket.on('create_room')
  socket.on('join_room')
  socket.on('start_game')
  socket.on('draw_tile')
  socket.on('play_tile')
  socket.on('claim_pong/chow/kong')
  socket.on('declare_win')
  socket.on('pass')
  socket.on('disconnect')
})

// 5. æœåŠ¡å™¨å¯åŠ¨
server.listen(PORT)
```

**æ ¸å¿ƒç®—æ³•**ï¼š
- æ´—ç‰Œç®—æ³•ï¼šFisher-Yates
- èƒ¡ç‰Œåˆ¤æ–­ï¼šé€’å½’å›æº¯
- ç•ªå‹è®¡ç®—ï¼šè§„åˆ™åŒ¹é…

**æ•°æ®ç»“æ„**ï¼š
```javascript
Room {
  roomId: String,
  players: Array<Player>,
  deck: Array<String>,
  wall: Array<String>,
  currentPlayerIndex: Number,
  gameStarted: Boolean,
  lastDiscard: Object
}

Player {
  id: String,
  name: String,
  hand: Array<String>,
  discarded: Array<String>,
  melds: Array<Meld>,
  score: Number
}

Meld {
  type: 'pong' | 'chow' | 'kong',
  tiles: Array<String>
}
```

---

#### `package.json`
**åŠŸèƒ½**ï¼šé¡¹ç›®é…ç½®æ–‡ä»¶

**å…³é”®ä¾èµ–**ï¼š
```json
{
  "dependencies": {
    "express": "^4.18.2",    // Web æœåŠ¡å™¨
    "socket.io": "^4.6.1"    // WebSocket é€šä¿¡
  },
  "devDependencies": {
    "nodemon": "^3.0.1"      // å¼€å‘çƒ­é‡è½½
  },
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  }
}
```

---

### å‰ç«¯æ–‡ä»¶

#### `public/index.html` (200+ è¡Œ)
**åŠŸèƒ½**ï¼šæ¸¸æˆç•Œé¢ç»“æ„

**ä¸»è¦åŒºå—**ï¼š
```html
<!-- 1. ç™»å½•ç•Œé¢ -->
<div id="login-screen">
  - æ¸¸æˆæ ‡é¢˜
  - æ˜µç§°è¾“å…¥
  - åˆ›å»º/åŠ å…¥æˆ¿é—´æŒ‰é’®
  - æ¸¸æˆè¯´æ˜
</div>

<!-- 2. ç­‰å¾…ç•Œé¢ -->
<div id="waiting-screen">
  - æˆ¿é—´å·æ˜¾ç¤º
  - ç©å®¶æ§½ä½ (4ä¸ª)
  - å¼€å§‹æ¸¸æˆæŒ‰é’®
</div>

<!-- 3. æ¸¸æˆç•Œé¢ -->
<div id="game-screen">
  - æ¸¸æˆä¿¡æ¯æ 
  - å¯¹æ‰‹åŒºåŸŸ (ä¸Šã€å·¦ã€å³)
  - å¼ƒç‰Œæ± 
  - ç©å®¶æ‰‹ç‰ŒåŒº
  - æ“ä½œæŒ‰é’®
</div>

<!-- 4. ç»“ç®—å¼¹çª— -->
<div id="game-over-modal">
  - èƒœåˆ©ä¿¡æ¯
  - ç•ªå‹æ˜¾ç¤º
  - æ‰‹ç‰Œå±•ç¤º
</div>

<!-- 5. æç¤ºæ¶ˆæ¯ -->
<div id="toast"></div>
```

**å¼•å…¥èµ„æº**ï¼š
```html
<link rel="stylesheet" href="style.css">
<script src="/socket.io/socket.io.js"></script>
<script src="client.js"></script>
```

---

#### `public/style.css` (800+ è¡Œ)
**åŠŸèƒ½**ï¼šæ·±è‰²ä¸»é¢˜æ ·å¼

**è®¾è®¡ç³»ç»Ÿ**ï¼š
```css
:root {
  --bg-dark: #0a0a0a;        /* ä¸»èƒŒæ™¯ */
  --bg-card: #252525;        /* å¡ç‰‡èƒŒæ™¯ */
  --gold: #ffd700;           /* é‡‘è‰²å¼ºè°ƒ */
  --text-primary: #ffffff;   /* ä¸»æ–‡å­— */
}
```

**æ ¸å¿ƒæ ·å¼**ï¼š
- **å¸ƒå±€**ï¼šFlexbox + Grid
- **åŠ¨ç”»**ï¼š
  - `fadeIn` - æ·¡å…¥
  - `tileAppear` - ç‰Œå‡ºç°
  - `pulse` - è„‰å†²é«˜äº®
  - `winPulse` - èƒ¡ç‰Œé—ªçƒ
- **å“åº”å¼**ï¼š
  - æ¡Œé¢ï¼šå®Œæ•´4äººç•Œé¢
  - ç§»åŠ¨ï¼šç®€åŒ–ä¸ºå•åˆ—å¸ƒå±€

**ç»„ä»¶æ ·å¼**ï¼š
```
.screen          â†’ é¡µé¢å®¹å™¨
.tile            â†’ éº»å°†ç‰Œ
.btn             â†’ æŒ‰é’®
.modal           â†’ å¼¹çª—
.toast           â†’ æç¤º
.opponent        â†’ å¯¹æ‰‹åŒº
.player-area     â†’ ç©å®¶åŒº
```

---

#### `public/client.js` (600+ è¡Œ)
**åŠŸèƒ½**ï¼šå‰ç«¯é€»è¾‘å’Œ Socket é€šä¿¡

**å…¨å±€çŠ¶æ€**ï¼š
```javascript
gameState = {
  roomId: String,
  playerName: String,
  playerId: String,
  playerIndex: Number,
  hand: Array<String>,
  currentPlayerIndex: Number,
  players: Array,
  canClaim: Object,
  selectedTile: String
}
```

**æ ¸å¿ƒå‡½æ•°**ï¼š
```javascript
// UI å·¥å…·
showScreen()           // åˆ‡æ¢ç•Œé¢
showToast()            // æ˜¾ç¤ºæç¤º
generateRoomId()       // ç”Ÿæˆæˆ¿é—´å·

// æ¸²æŸ“å‡½æ•°
renderHand()           // æ¸²æŸ“æ‰‹ç‰Œ
renderMelds()          // æ¸²æŸ“ç¢°æ 
createTileElement()    // åˆ›å»ºéº»å°†ç‰Œå…ƒç´ 
updateGameState()      // æ›´æ–°æ¸¸æˆçŠ¶æ€
updateOpponentDisplay() // æ›´æ–°å¯¹æ‰‹æ˜¾ç¤º

// äº¤äº’å‡½æ•°
onTileClick()          // ç‚¹å‡»æ‰‹ç‰Œ

// Socket ç›‘å¬
socket.on('connect')
socket.on('room_created')
socket.on('game_started')
socket.on('tile_drawn')
socket.on('tile_played')
socket.on('can_claim')
socket.on('game_over')
... å…±15ä¸ªäº‹ä»¶
```

**éº»å°†ç‰Œæ˜ å°„**ï¼š
```javascript
TILE_DISPLAY = {
  '1w': 'ä¸€è¬', '2w': 'äºŒè¬', ...
  '1t': 'ä¸€æ¡', '2t': 'äºŒæ¡', ...
  '1b': 'ä¸€ç­’', '2b': 'äºŒç­’', ...
  'dong': 'ä¸œ', 'nan': 'å—', ...
}
```

---

### æ–‡æ¡£æ–‡ä»¶

#### `README.md` (400+ è¡Œ)
**å†…å®¹**ï¼š
1. åŠŸèƒ½ç‰¹è‰²
2. å¿«é€Ÿå¼€å§‹
3. æ¸¸æˆç©æ³•
4. é¡¹ç›®ç»“æ„
5. Socket äº‹ä»¶è¯´æ˜
6. çº¿ä¸Šéƒ¨ç½²æŒ‡å—
7. å¼€å‘è¯´æ˜
8. æœªæ¥æ‰©å±•

#### `QUICKSTART.md` (200+ è¡Œ)
**å†…å®¹**ï¼š
1. ä¸€é”®å¯åŠ¨ (3æ­¥)
2. æœ¬åœ°æµ‹è¯•æ–¹æ³•
3. å¤šè®¾å¤‡è”æœº
4. å¸¸è§é—®é¢˜è§£å†³
5. æ¸¸æˆæ“ä½œé€ŸæŸ¥
6. å¼€å‘æç¤º

#### `SOCKET_EVENTS.md` (500+ è¡Œ)
**å†…å®¹**ï¼š
1. å®¢æˆ·ç«¯äº‹ä»¶ (10ä¸ª)
2. æœåŠ¡å™¨äº‹ä»¶ (15ä¸ª)
3. æ•°æ®ç»“æ„è¯¦è§£
4. å…¸å‹æµç¨‹ç¤ºä¾‹
5. é”™è¯¯å¤„ç†
6. æœ€ä½³å®è·µ

#### `PROJECT_STRUCTURE.md` (æœ¬æ–‡æ¡£)
**å†…å®¹**ï¼š
1. å®Œæ•´ç›®å½•æ ‘
2. æ–‡ä»¶è¯¦ç»†è¯´æ˜
3. ä»£ç ç»Ÿè®¡
4. æŠ€æœ¯æ ˆåˆ†æ
5. æ‰©å±•æŒ‡å—

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|------|
| `server.js` | ~580 | JavaScript | åç«¯æ ¸å¿ƒ |
| `client.js` | ~600 | JavaScript | å‰ç«¯é€»è¾‘ |
| `index.html` | ~200 | HTML | ç•Œé¢ç»“æ„ |
| `style.css` | ~800 | CSS | æ ·å¼è®¾è®¡ |
| `README.md` | ~400 | Markdown | ä¸»æ–‡æ¡£ |
| `QUICKSTART.md` | ~200 | Markdown | å¿«é€ŸæŒ‡å— |
| `SOCKET_EVENTS.md` | ~500 | Markdown | äº‹ä»¶æ–‡æ¡£ |
| **æ€»è®¡** | **~3,280** | - | - |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Express Server              â”‚
â”‚  (é™æ€æ–‡ä»¶æœåŠ¡ + API è·¯ç”±)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Socket.IO Server            â”‚
â”‚  (WebSocket å®æ—¶é€šä¿¡)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Room Management             â”‚
â”‚  (æˆ¿é—´ç®¡ç† + æ¸¸æˆé€»è¾‘)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰ç«¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            HTML DOM                 â”‚
â”‚  (ç•Œé¢ç»“æ„ + å…ƒç´ )                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CSS Styling                â”‚
â”‚  (æ·±è‰²ä¸»é¢˜ + å“åº”å¼)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       JavaScript Client             â”‚
â”‚  (çŠ¶æ€ç®¡ç† + Socket é€šä¿¡)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Socket.IO Client               â”‚
â”‚  (WebSocket è¿æ¥)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘
```
ç”¨æˆ·æ“ä½œ
    â†“
å‰ç«¯ UI äº‹ä»¶
    â†“
Socket.IO Client å‘é€
    â†“
WebSocket ä¼ è¾“
    â†“
Socket.IO Server æ¥æ”¶
    â†“
Room ç±»å¤„ç†é€»è¾‘
    â†“
éªŒè¯ + æ›´æ–°çŠ¶æ€
    â†“
Socket.IO Server å¹¿æ’­
    â†“
WebSocket ä¼ è¾“
    â†“
Socket.IO Client æ¥æ”¶
    â†“
æ›´æ–°å‰ç«¯çŠ¶æ€
    â†“
é‡æ–°æ¸²æŸ“ UI
```

---

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½çš„æ­¥éª¤

#### 1. åç«¯æ‰©å±• (server.js)
```javascript
// æ·»åŠ æ–°çš„ Socket äº‹ä»¶
socket.on('new_feature', (data) => {
  // 1. éªŒè¯æ•°æ®
  // 2. å¤„ç†é€»è¾‘
  // 3. æ›´æ–°çŠ¶æ€
  // 4. å¹¿æ’­ç»“æœ
});

// æ·»åŠ æ–°çš„ Room æ–¹æ³•
class Room {
  newFeature() {
    // å®ç°æ–°åŠŸèƒ½é€»è¾‘
  }
}
```

#### 2. å‰ç«¯æ‰©å±• (client.js)
```javascript
// æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬
socket.on('new_feature_result', (data) => {
  // æ›´æ–° UI
});

// æ·»åŠ æ–°çš„ UI å‡½æ•°
function handleNewFeature() {
  // å‘é€äº‹ä»¶
  socket.emit('new_feature', { ... });
}
```

#### 3. ç•Œé¢æ‰©å±• (index.html + style.css)
```html
<!-- æ·»åŠ æ–°çš„ UI å…ƒç´  -->
<div class="new-feature">
  <!-- å†…å®¹ -->
</div>
```

```css
/* æ·»åŠ æ–°çš„æ ·å¼ */
.new-feature {
  /* æ ·å¼è§„åˆ™ */
}
```

---

### ç¤ºä¾‹ï¼šæ·»åŠ èŠå¤©åŠŸèƒ½

#### 1. åç«¯ (server.js)
```javascript
socket.on('send_message', (data) => {
  const { roomId, message } = data;
  io.to(roomId).emit('new_message', {
    playerId: socket.id,
    playerName: getPlayerName(socket.id),
    message,
    timestamp: Date.now()
  });
});
```

#### 2. å‰ç«¯ (client.js)
```javascript
socket.on('new_message', (data) => {
  appendMessage(data);
});

function sendMessage() {
  const message = chatInput.value;
  socket.emit('send_message', {
    roomId: gameState.roomId,
    message
  });
}
```

#### 3. ç•Œé¢ (index.html)
```html
<div class="chat-panel">
  <div class="messages" id="messages"></div>
  <input type="text" id="chat-input" />
  <button onclick="sendMessage()">å‘é€</button>
</div>
```

---

## ğŸ¯ å¼€å‘å»ºè®®

### 1. ä»£ç è§„èŒƒ
- ä½¿ç”¨ ESLint æ£€æŸ¥ä»£ç 
- ä¿æŒå‡½æ•°å•ä¸€èŒè´£
- æ·»åŠ æ³¨é‡Šè¯´æ˜å¤æ‚é€»è¾‘
- ç»Ÿä¸€å‘½åè§„èŒƒ

### 2. æ€§èƒ½ä¼˜åŒ–
- é¿å…é¢‘ç¹ DOM æ“ä½œ
- ä½¿ç”¨äº‹ä»¶å§”æ‰˜
- ç¼“å­˜å¸¸ç”¨ DOM å…ƒç´ 
- ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½

### 3. å®‰å…¨è€ƒè™‘
- éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
- é˜²æ­¢ XSS æ”»å‡»
- é™åˆ¶æˆ¿é—´æ•°é‡
- æ·»åŠ æ“ä½œé¢‘ç‡é™åˆ¶

### 4. æµ‹è¯•å»ºè®®
- å•å…ƒæµ‹è¯•ï¼šæ ¸å¿ƒç®—æ³•
- é›†æˆæµ‹è¯•ï¼šSocket äº‹ä»¶
- å‹åŠ›æµ‹è¯•ï¼šå¤šæˆ¿é—´å¹¶å‘
- å…¼å®¹æ€§æµ‹è¯•ï¼šä¸åŒæµè§ˆå™¨

---

## ğŸ“š å­¦ä¹ èµ„æº

### ç›¸å…³æŠ€æœ¯æ–‡æ¡£
- [Node.js å®˜æ–¹æ–‡æ¡£](https://nodejs.org/docs/)
- [Express.js æ–‡æ¡£](https://expressjs.com/)
- [Socket.IO æ–‡æ¡£](https://socket.io/docs/)
- [MDN Web æ–‡æ¡£](https://developer.mozilla.org/)

### éº»å°†è§„åˆ™
- é©¬æ¥è¥¿äºšéº»å°†è§„åˆ™
- ç•ªå‹è®¡ç®—æ–¹æ³•
- èƒ¡ç‰Œåˆ¤å®šç®—æ³•

---

**å®Œæ•´çš„é¡¹ç›®ç»“æ„è¯´æ˜ï¼Œå¸®åŠ©ä½ ç†è§£å’Œæ‰©å±•è¿™ä¸ªæ¸¸æˆï¼ğŸ“âœ¨**