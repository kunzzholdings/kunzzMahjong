# 🎮 马来西亚麻将游戏 - 项目总览

> 一个完整的、可运行的、支持4人联机的网页麻将游戏

---

## 🚀 10秒快速开始

```bash
npm install    # 安装依赖
npm start      # 启动服务器
# 浏览器打开: http://localhost:3000
```

**就这么简单！**

---

## ✨ 项目亮点

### 🎯 功能完整
- ✅ 4人实时对战
- ✅ 完整麻将规则（吃、碰、杠、胡）
- ✅ 多种番型（平胡、碰碰胡、清一色等）
- ✅ 自动发牌、洗牌、计分
- ✅ 流局判定

### 🎨 界面精美
- 🌑 深色主题，黑金配色
- ✨ 流畅动画效果
- 📱 响应式设计（手机+桌面）
- 🎯 直观的操作体验

### 💻 技术先进
- Node.js + Express 后端
- Socket.IO 实时通信
- 原生 JavaScript（无框架依赖）
- WebSocket 双向通信

### 📚 文档齐全
- 5 份详细文档
- Socket 事件完整说明
- 快速启动指南
- 项目结构分析

---

## 📦 项目内容

### 核心文件 (4个)
| 文件 | 大小 | 说明 |
|------|------|------|
| `server.js` | ~580 行 | 后端服务器 + 游戏逻辑 |
| `client.js` | ~600 行 | 前端逻辑 + Socket 通信 |
| `index.html` | ~200 行 | 游戏界面结构 |
| `style.css` | ~800 行 | 深色主题样式 |

### 文档文件 (5个)
| 文档 | 说明 |
|------|------|
| `README.md` | 完整说明文档 (400+ 行) |
| `QUICKSTART.md` | 快速启动指南 (200+ 行) |
| `SOCKET_EVENTS.md` | Socket 事件详解 (500+ 行) |
| `PROJECT_STRUCTURE.md` | 项目结构分析 (400+ 行) |
| `OVERVIEW.md` | 本文档 |

### 总代码量
- **JavaScript**: ~1,180 行
- **HTML**: ~200 行
- **CSS**: ~800 行
- **文档**: ~1,500 行
- **总计**: ~3,680 行

---

## 🎯 功能特性

### 游戏功能
```
✅ 房间系统
   └─ 创建房间 (自动生成房间号)
   └─ 加入房间 (输入房间号)
   └─ 等待玩家 (4人开始)

✅ 游戏流程
   └─ 自动洗牌发牌
   └─ 轮流摸牌出牌
   └─ 实时同步状态
   └─ 胡牌结算

✅ 操作系统
   └─ 吃 (组成顺子)
   └─ 碰 (组成刻子)
   └─ 杠 (组成杠子)
   └─ 胡 (达成胡牌)
   └─ 过 (放弃操作)

✅ 番型系统
   └─ 平胡 (1番)
   └─ 自摸 (+1番)
   └─ 碰碰胡 (+2番)
   └─ 混一色 (+3番)
   └─ 清一色 (+5番)

✅ 其他功能
   └─ 流局判定
   └─ 断线提示
   └─ 操作提示
   └─ 回合计时
```

---

## 🛠️ 技术栈

### 后端
- **运行环境**: Node.js 14+
- **Web 框架**: Express.js 4.18
- **实时通信**: Socket.IO 4.6
- **架构模式**: 事件驱动

### 前端
- **HTML5**: 语义化标签
- **CSS3**: 
  - Flexbox 布局
  - Grid 布局
  - 渐变 + 动画
  - 响应式设计
- **JavaScript**:
  - ES6+ 语法
  - 原生 DOM 操作
  - Socket.IO Client
  - 事件监听

### 通信
- **协议**: WebSocket
- **库**: Socket.IO
- **特性**:
  - 双向通信
  - 自动重连
  - 房间管理
  - 事件广播

---

## 📊 核心算法

### 1. 洗牌算法
```javascript
Fisher-Yates Shuffle
时间复杂度: O(n)
空间复杂度: O(1)
```

### 2. 胡牌判断
```javascript
递归回溯算法
判断: 4组牌型 + 1对将
支持: 顺子、刻子、对子
时间复杂度: O(n!)
```

### 3. 番型计算
```javascript
规则匹配系统
检查: 清一色、碰碰胡等
返回: 番型列表 + 番数
```

### 4. 操作判定
```javascript
吃: 检查顺子组合
碰: 检查刻子组合
杠: 检查四张相同
胡: 递归判断牌型
```

---

## 🔌 Socket 事件

### 客户端 → 服务器 (10个)
1. `create_room` - 创建房间
2. `join_room` - 加入房间
3. `start_game` - 开始游戏
4. `draw_tile` - 摸牌
5. `play_tile` - 出牌
6. `claim_pong` - 碰牌
7. `claim_chow` - 吃牌
8. `claim_kong` - 杠牌
9. `declare_win` - 胡牌
10. `pass` - 过

### 服务器 → 客户端 (15个)
1. `room_created` - 房间创建
2. `player_joined` - 玩家加入
3. `player_left` - 玩家离开
4. `game_started` - 游戏开始
5. `tile_drawn` - 摸牌成功
6. `tile_played` - 出牌广播
7. `can_claim` - 操作提示
8. `next_turn` - 下一回合
9. `pong_claimed` - 碰牌成功
10. `chow_claimed` - 吃牌成功
11. `kong_claimed` - 杠牌成功
12. `update_hand` - 更新手牌
13. `game_state` - 状态更新
14. `game_over` - 游戏结束
15. `error` - 错误消息

---

## 🎮 游戏流程

```
┌─────────────┐
│  登录界面   │ ← 输入昵称
└──────┬──────┘
       │
       ├─→ 创建房间 ─→ 生成房间号
       │
       └─→ 加入房间 ─→ 输入房间号
               │
       ┌───────▼───────┐
       │  等待界面     │ ← 显示玩家列表
       │  (1-4 人)     │
       └───────┬───────┘
               │ 4人齐全
       ┌───────▼───────┐
       │  游戏开始     │ ← 发牌 (每人13张)
       └───────┬───────┘
               │
       ┌───────▼───────┐
       │  游戏进行中   │
       │ ┌───────────┐ │
       │ │ 摸牌      │ │
       │ │    ↓      │ │
       │ │ 出牌 ─────┼─┼─→ 其他玩家判断
       │ │    ↑      │ │   吃/碰/杠/胡/过
       │ │    │      │ │        │
       │ │ 下一回合 ←┼─┼────────┘
       │ └───────────┘ │
       └───────┬───────┘
               │
       ┌───────▼───────┐
       │  游戏结束     │
       │              │
       ├─→ 胡牌       │ ← 显示番型
       │              │
       └─→ 流局       │ ← 牌堆用完
       
```

---

## 📱 界面展示

### 登录界面
```
╔═══════════════════════════════════╗
║                                   ║
║      🀄 马来西亚麻将              ║
║        四人联机对战               ║
║                                   ║
║  ┌─────────────────────────────┐ ║
║  │ 输入你的昵称                │ ║
║  └─────────────────────────────┘ ║
║                                   ║
║  ┌─────────────────────────────┐ ║
║  │      创建房间                │ ║
║  └─────────────────────────────┘ ║
║              或                   ║
║  ┌─────────────────────────────┐ ║
║  │ 输入房间号                   │ ║
║  └─────────────────────────────┘ ║
║  ┌─────────────────────────────┐ ║
║  │      加入房间                │ ║
║  └─────────────────────────────┘ ║
║                                   ║
╚═══════════════════════════════════╝
```

### 游戏界面
```
╔═══════════════════════════════════════════╗
║ 房间: ABC123  剩余: 88  回合: 玩家1      ║
╠═══════════════════════════════════════════╣
║            [对手3] 🀄×13                 ║
║                                           ║
║  [对手2]      [弃牌池]       [对手4]    ║
║   🀄×13        🀄🀄🀄         🀄×13     ║
║                🀄🀄🀄                    ║
║                                           ║
║  ┌─────────────────────────────────────┐ ║
║  │ [碰: 5w 5w 5w]                      │ ║
║  │                                      │ ║
║  │ 🀄 🀄 🀄 🀄 🀄 🀄 🀄 🀄 🀄 🀄     │ ║
║  │ 1w 2w 3w 4w 5w 6w 7w 8w 9w 1t      │ ║
║  │                                      │ ║
║  │         你的手牌                     │ ║
║  └─────────────────────────────────────┘ ║
║                                           ║
║  [摸牌]  或  [吃] [碰] [杠] [胡] [过]   ║
╚═══════════════════════════════════════════╝
```

---

## 🚀 部署选项

### 本地运行
```bash
npm install
npm start
# 访问 http://localhost:3000
```

### 云平台部署

#### Render (推荐)
1. 上传到 GitHub
2. Render 创建 Web Service
3. 自动部署

#### Railway
1. 连接 GitHub
2. 一键部署
3. 自动分配域名

#### Vercel
1. 配置 Serverless
2. Vercel CLI 部署

#### 自建 VPS
```bash
# 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 克隆项目
git clone <repo-url>
cd mahjong-game
npm install

# PM2 运行
npm install -g pm2
pm2 start server.js
pm2 save
```

---

## 🔧 自定义配置

### 修改端口
```javascript
// server.js
const PORT = process.env.PORT || 3000; // 改为其他端口
```

### 修改初始手牌数
```javascript
// server.js - startGame()
for (let i = 0; i < 13; i++) { // 改为其他数字
  player.hand.push(this.wall.shift());
}
```

### 修改颜色主题
```css
/* style.css */
:root {
  --bg-dark: #0a0a0a;     /* 背景色 */
  --gold: #ffd700;        /* 强调色 */
}
```

### 添加新番型
```javascript
// server.js - calculateFan()
if (this.isNewFanType(hand, melds)) {
  fanTypes.push('新番型');
  fanCount += 5;
}
```

---

## 📋 测试清单

### 功能测试
- [ ] 创建房间成功
- [ ] 加入房间成功
- [ ] 4人游戏开始
- [ ] 正常摸牌出牌
- [ ] 吃碰杠操作
- [ ] 胡牌判定正确
- [ ] 番型计算正确
- [ ] 流局判定
- [ ] 断线处理

### 性能测试
- [ ] 多房间并发
- [ ] 大量玩家同时在线
- [ ] 长时间运行稳定性

### 兼容性测试
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge
- [ ] 移动浏览器

---

## 🎯 未来扩展

### 近期计划
- [ ] AI 机器人玩家
- [ ] 聊天功能
- [ ] 观战模式
- [ ] 游戏回放

### 中期计划
- [ ] 排行榜系统
- [ ] 好友系统
- [ ] 积分系统
- [ ] 成就系统

### 远期计划
- [ ] 语音聊天
- [ ] 多种麻将规则
- [ ] 锦标赛模式
- [ ] 跨平台客户端

---

## 📞 技术支持

### 遇到问题？

1. **查看文档**
   - `README.md` - 完整说明
   - `QUICKSTART.md` - 快速指南
   - `SOCKET_EVENTS.md` - 事件详解

2. **检查日志**
   - 浏览器控制台 (F12)
   - 服务器终端输出

3. **常见问题**
   - 端口被占用 → 更改端口
   - 无法连接 → 检查防火墙
   - npm 失败 → 使用镜像

4. **获取帮助**
   - 提交 GitHub Issue
   - 查看项目 Wiki
   - 联系开发者

---

## 🎓 学习价值

这个项目适合学习：

1. **Node.js 开发**
   - Express 框架
   - 事件驱动编程
   - 异步处理

2. **实时通信**
   - WebSocket 原理
   - Socket.IO 使用
   - 房间管理

3. **前端技能**
   - 原生 JavaScript
   - DOM 操作
   - 事件处理
   - CSS 布局

4. **游戏逻辑**
   - 回合制系统
   - 状态同步
   - 规则判定
   - 算法实现

---

## 📜 许可证

MIT License - 免费使用和修改

---

## 🙏 致谢

感谢所有对这个项目感兴趣的开发者和玩家！

---

**现在就开始你的麻将之旅吧！🀄🎉**

```
╔═══════════════════════════════════╗
║                                   ║
║   复制整个 mahjong-game 文件夹   ║
║                                   ║
║   $ npm install                   ║
║   $ npm start                     ║
║                                   ║
║   🎮 享受游戏！                   ║
║                                   ║
╚═══════════════════════════════════╝
```